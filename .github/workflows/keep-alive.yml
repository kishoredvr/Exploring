name: Supabase Keep-Warm

on:
  # Ping every 4 hours to prevent cold starts completely
  schedule:
    - cron: '0 */4 * * *'
  workflow_dispatch:

permissions:
  contents: read

jobs:
  keep-warm:
    runs-on: ubuntu-latest
    steps:
      - name: Ping all endpoints
        run: |
          BASE="https://lkvcbpxkpwpoqjlcddgl.functions.supabase.co"
          
          # Create a test payload
          PAYLOAD='{"test":true,"keep_alive":true,"run_id":"'"${{ github.run_id }}"'"}'
          
          # Array of endpoints
          ENDPOINTS=("/submit-form" "/initiate-payment" "/payment-status")
          
          for ENDPOINT in "${ENDPOINTS[@]}"; do
            echo "Pinging $ENDPOINT..."
            curl -s -X POST "$BASE$ENDPOINT" \
              -H "Content-Type: application/json" \
              -d "$PAYLOAD" \
              -w " -> HTTP %{http_code}\n" \
              --max-time 20 || echo "Failed to reach $ENDPOINT"
            sleep 1
          done
