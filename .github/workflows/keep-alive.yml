name: Keep Supabase Alive

on:
  schedule:
    - cron: '0 */72 * * *'  # Every 72 hours
  workflow_dispatch:

jobs:
  ping-supabase:
    runs-on: ubuntu-latest
    steps:
      - name: Wake Up Supabase Functions
        run: |
          URL="https://lkvcbpxkpwpoqjlcddgl.functions.supabase.co"
          
          echo "Waking up Supabase at $(date)"
          
          # Ping submit-form endpoint
          curl -X POST "$URL/submit-form" \
            -H "Content-Type: application/json" \
            -d '{"test":true,"ping":1,"timestamp":"'"$(date -u +"%Y-%m-%dT%H:%M:%SZ")"'"}' \
            --silent --max-time 30 || true
          
          echo "submit-form pinged"
          
          # Ping initiate-payment endpoint  
          curl -X POST "$URL/initiate-payment" \
            -H "Content-Type: application/json" \
            -d '{"amount":100,"userId":"test@example.com","mobileNumber":"9876543210"}' \
            --silent --max-time 30 || true
          
          echo "initiate-payment pinged"
          
          echo "âœ… Supabase functions should stay warm!"
